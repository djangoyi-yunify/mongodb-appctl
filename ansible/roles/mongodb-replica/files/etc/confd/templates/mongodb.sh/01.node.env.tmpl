{{- $nodeRole := index (split (getv "/host/role") "_node") 0 }}

tmpstr={{ getv "/env/conf.net.port" }}
flush > /opt/app/current/bin/envs/node.env << NODE_ENV_FILE
NODE_CTL=nodectl
MY_SID={{ getv "/host/sid" }}
MY_IP={{ getv "/host/ip" }}
MY_ROLE={{ $nodeRole }}
GLOBAL_UUID={{ getv "/cluster/global_uuid" }}
CLUSTER_ID={{ getv "/cluster/cluster_id" }}
DATA_MOUNTS="/data"
CONF_NET_PORT=$tmpstr
SERVICES="mongod/true/tcp:$tmpstr"
CONF_MAINTAIN_NET_PORT=27099
QC_USER=qc_master

{{- if len (ls "/vertical-scaling-roles") }}
VERTICAL_SCALING_FLAG=true
{{- else }}
VERTICAL_SCALING_FLAG=false
{{- end }}

{{- if len (ls "/change-vxnet-audit") }}
CHANGE_VXNET_FLAG=true
{{- else }}
CHANGE_VXNET_FLAG=false
{{- end }}

{{- if len (ls "/adding-hosts") }}
ADDING_HOSTS_FLAG=true
{{- else }}
ADDING_HOSTS_FLAG=false
{{- end }}
NODE_ENV_FILE